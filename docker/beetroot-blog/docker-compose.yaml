version: "3.8"

services:
  hugo:
    image: hugomods/hugo:latest
    container_name: beetroot_hugo_builder
    working_dir: /site
    command: >
      hugo
      --config /site/config.toml
      --contentDir /shared/content
      --staticDir /shared/static
      --destination /public
    volumes:
      - ./site:/site
      - ../../shared/blog/content:/shared/content
      - ../../shared/blog/static:/shared/static
      - ../../shared/blog/public:/public
    networks:
      - beetroot
    restart: "no"

  blog:
    image: nginx:alpine
    container_name: beetroot_blog
    volumes:
      - ../../shared/blog/public:/usr/share/nginx/html:ro
      - ./nginx/nginx.conf:/etc/nginx/conf.d/default.conf:ro
    ports:
      - "1313:80"  # Traefik will handle routing later
    networks:
      - beetroot
    restart: unless-stopped

networks:
  beetroot:
    external: true
